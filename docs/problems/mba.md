# 多値ビザンチン合意 (Multi-valued Byzantine Agreement)

## 概要

**多値ビザンチン合意 (MBA)** とは、各プロセスがそれぞれ**任意の価**（例えば、文字列や数値など）を提案し、その中から**単一の値を全員で合意する**問題です。

前回のABA問題が「0か1か」の二者択一だったのに対し、MBAはより一般的で複雑な状況を扱います。

## 達成すべき性質

MBAプロトコルは、ABAと同様に3つの重要な条件を満たす必要があります。

* **1. 合意性 (Agreement)**
    正常なプロセスは、**全員が必ず同じ値**に決定しなければなりません。

* **2. 正当性 (Validity)**
    最終的に合意された値は、必ず**いずれかの正常なプロセスによって最初に提案された値**でなければなりません。誰も提案していない値や、裏切り者だけが提案した値に決まることはありません。

* **3. 終了性 (Termination)**
    全ての正常なプロセスは、**有限時間内に必ず値を決定**し、処理を終了しなければなりません。

## どうやって解決するのか？ (ABAからの構築)

MBAは非常に複雑なため、直接解くのは困難です。そこで、**ABAプロトコルを基本的な部品（ビルディングブロック）として利用**してMBAを構築する、というアプローチが一般的です。

### 解決までのステップ

1.  **提案 (Propose)**
    まず、各プロセスが「私はこの値にしたい」という自分の提案値`v`を全員にブロードキャスト（一斉送信）します。

2.  **ABAの実行 (Reduce to ABA)**
    次に、考えられる**全ての提案値候補ごと**に、独立したABAのインスタンス（話し合いの場）を並行して開始します。
    * 値`A`についてのABA: 「値`A`に合意しますか？ Yes(1) / No(0)」
    * 値`B`についてのABA: 「値`B`に合意しますか？ Yes(1) / No(0)」
    * 値`C`についてのABA: 「値`C`に合意しますか？ Yes(1) / No(0)」
        ...

3.  **決定 (Decide)**
    複数のABAが並行して進み、その中で**一番最初に「1 (Yes)」という結果で合意が成立したABA**の対応する値（例えば、値`B`のABAが1で合意）を、MBA全体の最終的な合意値として採用します。

この手法は、複雑な多値の問題を、単純な「Yes/No」の問題に繰り返し帰着させることで解決しており、「MBAのABAへの還元」と呼ばれます。

## なぜ重要なのか？

現実の分散システムで合意したい事柄は、単なる「Yes/No」よりも「どのデータを書き込むか」「どのトランザクションを実行するか」といった多値のケースがほとんどです。

- **分散データベース**: 次にコミットするトランザクションの順序の合意。
- **ブロックチェーン**: 次にチェーンに追加するブロックの合意。
- **ステートマシンレプリケーション**: サーバー群で次に実行するコマンドの合意。

このように、MBAは信頼性の高い分散システムを構築する上で、非常に実用的で中心的な役割を担う技術です。
